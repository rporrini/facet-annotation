@prefix map: <#> .
@prefix db: <> .
@prefix vocab: <http://catalog.shoppydoo.com/vocabulary/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix meta: <http://www4.wiwiss.fu-berlin.de/bizer/d2r-server/metadata#> .
@prefix d2r: <http://sites.wiwiss.fu-berlin.de/suhl/bizer/d2r-server/config.rdf#> .
@prefix d2rq: <http://www.wiwiss.fu-berlin.de/suhl/bizer/D2RQ/0.1#> .
@prefix jdbc: <http://d2rq.org/terms/jdbc/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix gr: <http://purl.org/goodrelations/v1#> .

############################### server configuration #############################################
<> a d2r:Server;
  rdfs:label "D2R Server for TrovaPrezzi";
  d2r:baseURI <http://localhost:2020/>;
  d2r:port 2020;
  d2r:vocabularyIncludeInstances true;
  d2r:limitPerClassMap 50;
  d2r:sparqlTimeout 0;
  .

######################################## db ###################################################
map:database a d2rq:Database;
	d2rq:jdbcDriver "org.postgresql.Driver";
	d2rq:jdbcDSN "jdbc:postgresql://localhost/schededb";
	d2rq:username "postgres";
	.

####################################### categories ######################################
map:Category a d2rq:ClassMap;
	d2rq:dataStorage map:database;
	d2rq:uriPattern "categories/@@Product_Category_Description_Voc.category_name|urlify@@";
	d2rq:condition "Product_Category_Description_Voc.lang_code = 'en'";
	d2rq:class skos:Concept;
	.

map:categoryName a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Category;
	d2rq:property rdf:label;
	d2rq:column "Product_Category_Description_Voc.category_name";
	d2rq:lang "en";
	.

map:subCategoryOf a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Category;
	d2rq:property skos:broader;
	d2rq:refersToClassMap map:Category;
	d2rq:alias "Product_Category_Description_Voc AS Parent_Product_Categories";
	d2rq:join "Product_Category_Description_Voc.category_id => Product_Categories.category_id";
	d2rq:join "Product_Categories.parent_category_id <= Parent_Product_Categories.category_id";
	.

#################################### dimensions ##############################################
map:Dimension a d2rq:ClassMap;
	d2rq:dataStorage map:database;
	d2rq:uriPattern "dimensions/@@Parameter_Description_Voc.param_id@@";
	d2rq:condition "Parameter_Description_Voc.lang_code = 'en'";
	d2rq:condition "Parameter_Description_Voc.unit <> ''";
	d2rq:condition "Parameter_Description_Voc.unit is not null";
	d2rq:class gr:QuantitativeValue;
	.

map:dimensionLabel a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Dimension;
	d2rq:property rdf:label;
	d2rq:column "Parameter_Description_Voc.parameter_name";
	d2rq:lang "en";
	d2rq:condition "Parameter_Description_Voc.lang_code = 'en'";
	.

#map:hasValue a d2rq:PropertyBridge;
#	d2rq:belongsToClassMap map:Dimension;
#	d2rq:property gr:hasValue;
#	d2rq:join "Parameter_Description_Voc.param_id = Product_Parameters.param_id";
#	d2rq:column "Product_Parameters.param_value";
#	.

map:hasUnit a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Dimension;
	d2rq:refersToClassMap map:Unit;
	d2rq:join "Parameter_Description_Voc.param_id = Parameter_Description_Voc.param_id";
	d2rq:property gr:hasUnitOfMeasurement;
	.

map:usedForCategory a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Dimension;
	d2rq:refersToClassMap map:Category;
	d2rq:property vocab:usedFor;
	d2rq:join "Parameter_Description_Voc.param_id = Parameters.param_id";
	d2rq:join "Parameters.prod_category_id = Product_Categories.category_id";
	d2rq:join "Product_Categories.category_id = Product_Category_Description_Voc.category_id";
	.

#################################### units ##############################################
map:Unit a d2rq:ClassMap;
	d2rq:dataStorage map:database;
	d2rq:uriPattern "units/@@Parameter_Description_Voc.unit|urlify@@";
	d2rq:condition "Parameter_Description_Voc.lang_code = 'en'";
	d2rq:containsDuplicates true;
	d2rq:class rdfs:Class;
	d2rq:condition "Parameter_Description_Voc.unit <> ''";
	d2rq:condition "Parameter_Description_Voc.unit is not null";
	.

map:unitLabel a d2rq:PropertyBridge;
	d2rq:belongsToClassMap map:Unit;
	d2rq:property rdf:label;
	d2rq:column "Parameter_Description_Voc.unit";
	d2rq:lang "en";
	d2rq:condition "Parameter_Description_Voc.lang_code = 'en'";
	.

